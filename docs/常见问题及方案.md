# 常见问题及方案

-----------------------------------------------

## 1、Linux 上安装 Python 3.9.9

```shell
#!/bin/bash
# 刷新源
sudo apt update
# 装依赖
sudo apt install -y zlib1g-dev libbz2-dev libssl-dev libncurses5-dev libsqlite3-dev libreadline-dev tk-dev libgdbm-dev libdb-dev libpcap-dev xz-utils libexpat1-dev liblzma-dev libffi-dev libc6-dev
# 下载源码
wget https://cdn.npm.taobao.org/dist/python/3.9.9/Python-3.9.9.tgz
# 解压
tar -xzf Python-3.9.9.tgz
# 放在/usr/local/share/下
sudo mv  Python-3.9.9 /usr/local/share/
# 编译
cd  /usr/local/share/Python-3.9.9/
./configure --prefix=/usr/local/python3.9
# 设置优化选项--enable-optimizations
# ./configure --prefix=/usr/local/python3.9 --enable-optimizations
make -j4
sudo make install
# 设置软连接
sudo ln -s /usr/local/python3.9/bin/python3.9 /usr/bin/python3.9
sudo ln -s /usr/local/python3.9/bin/python3.9-config /usr/bin/python3.9-config
```

-------------------------------------------

## 2、Linux 上安装 Node.js

【方法一】

在官网下载：https://nodejs.cn/download/current/

建议选择最新的 `LTS` 版本；

下载下来加压到 `/opt` 目录下：

```shell
ln -s /opt/nodejs/bin/npm   /usr/bin/npm
ln -s /opt/nodejs/bin/node   /usr/bin/node
```

【方法二】

`Node.js LTS (v18.x)`:

```
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash - &&\
sudo apt-get install -y nodejs
```

安装完之后查看版本，没报错就说明安装好了；

```shell
mikigo@mikigo-PC:~$ node -v
v16.18.1
mikigo@mikigo-PC:~$ npm -v
8.19.2
```

---------------------------------------

## 3、配置开机自启服务

写开机自启服务文件：

```shell
sudo vim /lib/systemd/system/test.service
```

写入以下内容：

```shell
[Unit]
Description=Test Service
After=multi-user.target

[Service]
User=uos
Group=uos
Type=idle
WorkingDirectory=/home/uos/ocr_env
ExecStart=$do you shell scripts$

[Install]
WantedBy=multi-user.target
```

注意，在 `ExecStart=$do you shell scripts$` 里面配置你的要执行的命令比如：`ExecStart=bash test.sh`

修改配置文件的权限：

```shell
sudo chmod 644 /lib/systemd/system/test.service
```

自启服务生效：

```shell
sudo systemctl daemon-reload
sudo systemctl enable test.service
```

查看服务状态：

```shell
sudo systemctl status test.service
```

--------------------------------

## 4、配置Python源的几种方法

### （1）临时添加三方源

```shell
pip3 install funnylog -i https://pypi.tuna.tsinghua.edu.cn/simple
```

如果想临时添加多个，后面可以加多个 -i

```shell
pip3 install xxx -i yyyy -i zzzz
```

### （2）requirements.txt 添加三方源

```shell
# requirements.txt
-i https://pypi.tuna.tsinghua.edu.cn/simple
-i https://pypi.douban.com/simple/

funnylog
...
```

### （3）命令行永久配置

- 适用于 `pip3 install` 的安装方式：

```shell
pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

- 适用于 `sudo pip3 install` 的安装方式：

```shell
sudo pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

可以多次执行添加多个:

```shell
pip3 config set global.extra-index-url https://pypi.douban.com/simple/
p3 config set global.extra-index-url https://mirrors.aliyun.com/pypi/simple/
```

注意 `global.extra-index-url` 里面和上面不同；

### （4）修改配置文件永久配置

- 适用于 `pip3 install` 的安装方式：

```shell
vi ~/.config/pip/pip.conf
```

配置如下：

```config
[global]
index-url = https://pypi.douban.com/simple/
extra-index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

- 适用于 `sudo pip3 install` 的安装方式：

```shell
sudo vi /root/.config/pip/pip.conf
```

配置如下：

```shell
[global]
index-url = https://pypi.douban.com/simple/
extra-index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

### （5）常用的几个三方源

```shell
# 清华
https://pypi.tuna.tsinghua.edu.cn/simple/
# 阿里云
https://mirrors.aliyun.com/pypi/simple/
# 中国科技大学
https://pypi.mirrors.ustc.edu.cn/simple/
# 华中科技大学
https://pypi.hustunique.com/simple/
# 上海交通大学
https://mirror.sjtu.edu.cn/pypi/web/simple/
# 豆瓣
https://pypi.douban.com/simple/
```

-------------------------------------

## 5、Linux 上如何选择用 pip3 还是 sudo pip3

### （1）sudo pip3

如果这个包是带有**命令行工具**的，推荐使用`sudo pip3 install xxx` 进行安装;

这样命令行工具才能写入到系统目录下，一般是在 `/usr/local/bin/` 下面；

> 如果你没有加 `sudo` 安装，命令行工具无法写入到系统目录下，而是写入到 `$HOME/.local/bin`，这个路径很明显不是系统的环境变量，因此无法**直接**使用此命令，要想使用它你有**两种**方法：
>
> 第一种：
>
> ```shell
> # 进入到命令目录 
> cd $HOME/.local/bin/
> # 给命令执行赋权限
> sudo chmod +x mycmd
> # 执行它
> ./mycmd
> ```
>
> 第二种：
>
> 将 `$HOME/.local/bin` 添加到 `PATH` 里面:
>
> 临时修改：
>
> ```shell
> export PATH=/home/uos/.local/bin:$PATH
> #或者把PATH放在前面
> export PATH=$PATH:/home/uos/.local/bin
> ```
>
> 用户级别永久修改：
>
> ```shell
> vim ~/.bashrc
> # 在最后一行加上
> export PATH=$PATH:/home/uos/.local/bin
> ```
>
> 系统级别永久修改：
>
> ```shell
> vim ~/.bash_profile
> # 在最后一行加上
> export PATH=$PATH:/home/uusama/mysql/bin
> ```

你看如果带命令行工具的库，安装的时候没有加 `sudo` 你要多做多少事情；

所以请记住，带有**命令行工具**的三方库，安装的时候使用 `sudo pip3 install`。

### （2）pip3

如果这个库没有命令行工具，或者说它安装过程中不需要写入系统目录，你使用 pip3 或 sudo pip3 安装都可以；

但是，我个人推荐**不要加 `sudo`**；

原因就需要介绍一点点**背景知识**：

>在 Linux 上，Python 三方包通常被安装在以下三个路径中：
>
>1. `/usr/lib/pythonX.X/site-packages`
>
>   这个路径中安装的是系统默认的 Python 解释器的三方包，X.X 代表 Python 版本号，如 2.7、3.6;
>
>2. `/usr/local/lib/pythonX.X/site-packages`
>
>   这个路径中安装的是用户自己安装的 Python 解释器的三方包，X.X 代表 Python 版本号，如 2.7、3.6;
>
>3. `$HOME/.local/lib/pythonX.X/site-packages`
>
>   这个路径中安装的是当前用户的 Python 解释器的三方包，X.X代表 Python 版本号，如 2.7、3.6;
>
>在加载Python三方包时，系统会**按照以下顺序查找三方包的路径**：
>
>1. 先查找当前工作目录是否有需要的包;想
>2. 查找 `$HOME/.local/lib/pythonX.X/site-packages`;
>3. 查找 `/usr/local/lib/pythonX.X/site-packages`
>4. 查找 `/usr/lib/pythonX.X/site-packages`
>
>如果在以上路径中找到了需要的包，就会加载它们；
>
>如果没有找到，则会抛出ImportError异常；
>
>需要注意的是，如果相同的包存在于多个路径中，系统会加载最先找到的那个包，而不是后面找到的那个包；
>
>因此，如果有多个Python解释器或版本，并且使用了不同的路径安装三方包，就需要确认加载的包是否正确。

使用 `pip3` 安装的时候是安装到 `$HOME/.local/lib/pythonX.X/site-packages` 路径下；

而使用 `sudo pip3` 安装的时候是安装到 `/usr/local/lib/pythonX.X/site-packages` 路径下

基于前面的背景知识，这个路径是排在前面的，是会被**优先加载到**；

因此，**结论：我始终推荐优先考虑使用 `pip3` 安装（不加`sudo` ）；**

有同学要问了，凭啥优先加载到，我就要用它呢？你的领导做啥都先想到你，你觉得是不是好事，你细品～～

---------------



